import{s as B,n as N,j as D,r as j}from"../chunks/scheduler.a03335a9.js";import{S as q,i as z,g,s as k,h as v,x as A,c as w,j as I,f as b,k as i,a as x,z as p,D as E,A as S,F,m as T,n as W,o as H}from"../chunks/index.ccd29840.js";import{s as U}from"../chunks/supabaseClient.dfd487c3.js";import{g as P}from"../chunks/navigation.64c6ba14.js";function O(d){let e,a,n="Email:",l,t,r,s,o="Password:",u,h,_,f,y="Login",C,L;return{c(){e=g("form"),a=g("label"),a.textContent=n,l=k(),t=g("input"),r=k(),s=g("label"),s.textContent=o,u=k(),h=g("input"),_=k(),f=g("button"),f.textContent=y,this.h()},l(m){e=v(m,"FORM",{class:!0});var c=I(e);a=v(c,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),A(a)!=="svelte-1flf0h4"&&(a.textContent=n),l=w(c),t=v(c,"INPUT",{type:!0,id:!0,class:!0}),r=w(c),s=v(c,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),A(s)!=="svelte-bhu94"&&(s.textContent=o),u=w(c),h=v(c,"INPUT",{type:!0,id:!0,class:!0}),_=w(c),f=v(c,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),A(f)!=="svelte-1yamoz0"&&(f.textContent=y),c.forEach(b),this.h()},h(){i(a,"for","email"),i(a,"class","svelte-1fo3m63"),i(t,"type","text"),i(t,"id","email"),i(t,"class","svelte-1fo3m63"),i(s,"for","password"),i(s,"class","svelte-1fo3m63"),i(h,"type","password"),i(h,"id","password"),i(h,"class","svelte-1fo3m63"),i(f,"type","submit"),i(f,"class","svelte-1fo3m63"),i(e,"class","svelte-1fo3m63")},m(m,c){x(m,e,c),p(e,a),p(e,l),p(e,t),E(t,d[1]),p(e,r),p(e,s),p(e,u),p(e,h),E(h,d[2]),p(e,_),p(e,f),C||(L=[S(t,"input",d[4]),S(h,"input",d[5]),S(e,"submit",F(d[3]))],C=!0)},p(m,c){c&2&&t.value!==m[1]&&E(t,m[1]),c&4&&h.value!==m[2]&&E(h,m[2])},d(m){m&&b(e),C=!1,j(L)}}}function M(d){let e,a,n=d[0].email+"",l;return{c(){e=g("h1"),a=T("Welcome back, "),l=T(n),this.h()},l(t){e=v(t,"H1",{class:!0});var r=I(e);a=W(r,"Welcome back, "),l=W(r,n),r.forEach(b),this.h()},h(){i(e,"class","svelte-1fo3m63")},m(t,r){x(t,e,r),p(e,a),p(e,l)},p(t,r){r&1&&n!==(n=t[0].email+"")&&H(l,n)},d(t){t&&b(e)}}}function R(d){let e,a="Welcome back,",n,l;function t(o,u){return o[0]?M:O}let r=t(d),s=r(d);return{c(){e=g("h1"),e.textContent=a,n=k(),l=g("div"),s.c(),this.h()},l(o){e=v(o,"H1",{class:!0,"data-svelte-h":!0}),A(e)!=="svelte-i6nxgd"&&(e.textContent=a),n=w(o),l=v(o,"DIV",{class:!0});var u=I(l);s.l(u),u.forEach(b),this.h()},h(){i(e,"class","svelte-1fo3m63"),i(l,"class","svelte-1fo3m63")},m(o,u){x(o,e,u),x(o,n,u),x(o,l,u),s.m(l,null)},p(o,[u]){r===(r=t(o))&&s?s.p(o,u):(s.d(1),s=r(o),s&&(s.c(),s.m(l,null)))},i:N,o:N,d(o){o&&(b(e),b(n),b(l)),s.d()}}}function V(d,e,a){let n={},l="",t="";const r=(_,f)=>{console.log("Auth state changed:",_,f),a(0,n=f==null?void 0:f.user),n?(console.log("User found:",n),P("/usr_profile")):console.log("No user found")};console.log("Subscribing to auth state changes");const{data:s}=U.auth.onAuthStateChange(r);console.log("Subscribed to auth state changes"),D(()=>{console.log("Unsubscribing from auth state changes"),s!=null&&s.unsubscribe&&(s.unsubscribe(),console.log("Unsubscribed from auth state changes"))});const o=async()=>{console.log("Attempting to log in");try{const{user:_,session:f,error:y}=await U.auth.signInWithPassword({email:l,password:t});if(y)throw console.log("Error during sign in:",y.message),y;if(_){const{data:C,error:L}=await U.from("main").select("usr_lvl").eq("user_id",_.id).single();if(L){console.error("Error retrieving usr_lvl:",L.message);return}C.usr_lvl>=5?(console.log("Login successful for admin, redirecting to admin dashboard"),P("/admin_dashboard")):(console.log("Login successful for user, redirecting to user dashboard"),P("/usr_profile"))}}catch(_){console.error("Login failed:",_.message)}};function u(){l=this.value,a(1,l)}function h(){t=this.value,a(2,t)}return[n,l,t,o,u,h]}class X extends q{constructor(e){super(),z(this,e,V,R,B,{})}}export{X as component};
